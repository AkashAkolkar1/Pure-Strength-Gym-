<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Healthy U | Product Details</title>
  <script src="catalog.js"></script>
  <link rel="stylesheet" href="styles.css"/>
  <link rel = "icon" href = "assets/logo_1.jpeg" type = "image/x-icon">
  <style>
    .pd__wrap{max-width: var(--max-width); margin:auto; padding:5rem 1rem; display:grid; grid-template-columns: 1.1fr 1fr; gap:2rem;}
    .pd__gallery{background: var(--primary-color-light); border-radius:12px; padding:1rem; display:flex; align-items:center; justify-content:center;}
    .pd__gallery img{width:100%; max-height:460px; object-fit:contain; border-radius:10px;}
    .pd__info{background: var(--primary-color-light); border-radius:12px; padding:1.5rem;}
    .pd__brand{color:var(--text-light); margin-bottom:.5rem;}
    .pd__title{color:#fff; font-size:1.5rem; font-weight:600; margin-bottom:.25rem;}
    .pd__price{color:#fff; font-weight:700; font-size:1.25rem; margin:.25rem 0 1rem;}
    .pd__desc{color:var(--text-light); line-height:1.7;}
    .pd__meta{display:flex; gap:1rem; margin:1rem 0; color:var(--text-light);}
    .pd__row{display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin:1rem 0;}
    .pd__row.full{grid-template-columns:1fr;}
    select.pd__select{width:100%; padding:.75rem .9rem; border-radius:6px; border:1px solid var(--primary-color-extra-light); background:#fff; outline-color:#555;}
    .pd__actions{display:flex; gap:.75rem; margin-top:1rem;}
    .rating{display:flex; align-items:center; gap:.4rem;}
    .rating .star{color:#f9ac54; font-size:1.1rem;}
    .reviews{background: var(--primary-color-light); border-radius:12px; padding:1.25rem;}
    .review{border-top:1px solid var(--primary-color-extra-light); padding:.85rem 0; color:var(--text-light);}
    .review:first-child{border-top:none;}
    .related{display:grid; grid-template-columns: repeat(3,1fr); gap:1rem;}
    @media (width < 1000px){ .pd__wrap{grid-template-columns:1fr;} .related{grid-template-columns:1fr 1fr;} }
    @media (width < 600px){ .related{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <!-- Nav -->
  <nav>
    <div class="nav__logo">
      <a href="index.html"><img src="assets/Picture1.png" alt="Healthy U"/></a>
    </div>
      <ul class="nav__links">
  <li class="link"><a href="index.html">Home</a></li>
  <li class="link"><a href="product.html">Products</a></li>
  <li class="link"><a href="cart.html">Cart</a></li>
  <li class="link"><a href="checkout.html">Checkout</a></li>

  <!-- Shown when logged OUT -->
  <span id="navAuth" style="display:flex; gap: 3rem;">
    <li class="link"><a href="login.html">Login</a></li>
    <li class="link"><a href="register.html">Register</a></li>
  </span>

  <!-- Shown when logged IN -->
  <span id="navUser" style="display:none; gap:2rem; align-items:center;">
    <li class="link"><span style="color:#d1d5db;">Hi, <span id="navName">User</span></span></li>
    <li class="link"><a href="#" id="navSignOut">Sign Out</a></li>
  </span>
</ul>
  </nav>

  <section class="section__container">
    <h2 class="section__header">Product Details</h2>
  </section>

  <section class="pd__wrap">
    <div class="pd__gallery">
      <img id="pd_img" src="assets/placeholder.png" alt="Product"/>
    </div>
    <div class="pd__info">
      <div class="pd__brand" id="pd_brand">Brand: Healthy U</div>
      <div class="pd__title" id="pd_name">Product Name</div>
      <div class="rating" id="pd_rating"></div>
      <div class="pd__price" id="pd_price">₹0</div>

      <p class="pd__desc" id="pd_desc">Detailed description of the product highlighting key benefits, ingredients, and usage.</p>
      <div class="pd__meta">
        <span id="pd_tag">Category</span>
        <span id="pd_stock">In stock</span>
      </div>

      <div class="pd__row full" id="flavorRow" style="display:none;">
        <div>
          <label for="pd_flavor" style="color:var(--text-light);">Flavor</label>
          <select id="pd_flavor" class="pd__select"></select>
        </div>
      </div>

      <div class="pd__actions">
        <a href="cart.html" class="btn" id="pd_add">Add to Cart</a>
        <a href="checkout.html" class="price__btn" id="pd_buy">Buy Now</a>
      </div>
    </div>
  </section>

  <section class="section__container">
    <h3 class="section__header">Reviews</h3>
    <div class="reviews" id="pd_reviews"></div>
    <div class="reviews" id="pd_review_form" style="margin-top:1rem;">
  <!-- Shown based on login -->
</div>
  </section>

  <section class="section__container">
    <div class="explore__header">
      <h3 class="section__header">Related Products</h3>
      <div class="explore__nav"><span id="rprev">&#8249;</span><span id="rnext">&#8250;</span></div>
    </div>
    <div class="explore__grid" id="pd_related"></div>
  </section>

  <!-- Footer -->
  <footer class="section__container footer__container">
    <span class="bg__blur footer__blur"></span>
    <div class="footer__col">
      <div class="footer__logo">
       <div class="footer__logo"><img src="assets/Picture1.png" alt="logo" /></div>
      </div>
      <p>Your destination for holistic fitness and premium supplements.</p>
      <div class="footer__socials">
        <a href="#"><i class="ri-instagram-line"></i></a>
        <a href="#"><i class="ri-twitter-x-line"></i></a>
        <a href="#"><i class="ri-youtube-line"></i></a>
      </div>
    </div>
    <div class="footer__col">
      <h4>Company</h4>
      <a href="#">About</a>
      <a href="contact.html">Contact</a>
      <a href="docs/privacy-policy.pdf" target="_blank" rel="noopener">Privacy Policy</a>
    </div>
    <div class="footer__col">
      <h4>Support</h4>
      <a href="#">Help Center</a>
      <a href="docs/terms-and-conditions.pdf" target="_blank" rel="noopener">Terms</a>
      <a href="product.html">Shop</a>
    </div>
  </footer>
  <div class="footer__bar">© 2025 Healthy U. All rights reserved.</div>

  <script>
    // Shared helpers
    const CART_KEY='hu_cart';
    function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }
    function setCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); }
    function addToCart(item){
      const cart = getCart();
      const idx = cart.findIndex(p=>p.id===item.id && p.variant===item.variant);
      if(idx>-1){ cart[idx].qty += 1; } else { cart.push({...item, qty:1}); }
      setCart(cart);
      alert('Added to cart');
    }
    function money(n){ return '₹'+n; }
    function stars(r){
      const full = Math.floor(r), half = r - full >= 0.5;
      let s = '';
      for(let i=0;i<full;i++) s += '<span class="star">★</span>';
      if(half) s += '<span class="star">☆</span>';
      for(let i=s.replace(/[^★]/g,'').length + (half?1:0); i<5; i++) s += '<span class="star" style="opacity:.35;">★</span>';
      return s + `<span style="color:var(--text-light); font-size:.95rem;">(${r.toFixed(1)})</span>`;
    }

    // Catalog data (extend to match product.html)


  const catalog = window.catalog;
  const pid = new URLSearchParams(location.search).get('id');
  const product = catalog.find(p=>p.id===pid) || catalog[0];

    // Populate UI
    document.getElementById('pd_img').src = product.img;
    document.getElementById('pd_img').alt = product.name;
    document.getElementById('pd_brand').textContent = 'Brand: ' + (product.brand || 'Healthy U');
    document.getElementById('pd_name').textContent = product.name;
    document.getElementById('pd_price').textContent = money(product.price);
    document.getElementById('pd_desc').textContent = product.desc || 'Premium product.';
    document.getElementById('pd_tag').textContent = product.tag || '';
    document.getElementById('pd_stock').textContent = product.stock ? 'In stock' : 'Out of stock';
    document.getElementById('pd_rating').innerHTML = stars(product.rating || 4.5);

    // Flavors
    if(product.flavors && product.flavors.length){
      const row = document.getElementById('flavorRow');
      const sel = document.getElementById('pd_flavor');
      row.style.display = 'grid';
      product.flavors.forEach(f=>{
        const opt = document.createElement('option'); opt.value=f; opt.textContent=f; sel.appendChild(opt);
      });
    }

    // Add to cart / Buy
    document.getElementById('pd_add').addEventListener('click', (e)=>{
      const variant = (product.flavors && product.flavors.length) ? document.getElementById('pd_flavor').value : undefined;
      addToCart({ id:product.id, name:product.name + (variant?(' - '+variant):''), price:product.price, img:product.img, variant });
    });
    document.getElementById('pd_buy').addEventListener('click', (e)=>{
      const variant = (product.flavors && product.flavors.length) ? document.getElementById('pd_flavor').value : undefined;
      addToCart({ id:product.id, name:product.name + (variant?(' - '+variant):''), price:product.price, img:product.img, variant });
    });

    // Mock reviews data (could be stored alongside catalog)
    
    
    
    const reviews = {
      'whey-1': [
        { user:'Aarav', stars:5, text:'Great taste and excellent mixability.' },
        { user:'Neha', stars:4, text:'Good recovery, chocolate is the best.' }
      ],
      'gainer-3': [
        { user:'Rohit', stars:4, text:'Helped me gain healthy weight.' }
      ],
      'crea-300': [
        { user:'Simran', stars:5, text:'Noticeable strength gains within 2 weeks.' }
      ]
    };

    function renderReviews(){
      const box = document.getElementById('pd_reviews');
      const list = reviews[product.id] || [];
      if(list.length===0){
        box.innerHTML = '<p class="section__subheader">No reviews yet. Be the first to review.</p>';
        return;
      }
      box.innerHTML = '';
      list.forEach(r=>{
        const div = document.createElement('div');
        div.className = 'review';
        div.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <strong style="color:#fff;">${r.user}</strong>
            <div class="rating">${stars(r.stars)}</div>
          </div>
          <p style="margin-top:.25rem;">${r.text}</p>
        `;
        box.appendChild(div);
      });
    }
    renderReviews();

  // After existing code on product-details.html
  function getCurrentUser(){ return JSON.parse(localStorage.getItem('hu_user')||'null'); }

  function getProdReviews(pid){
    return JSON.parse(localStorage.getItem('reviews:'+pid) || '[]');
  }
  function setProdReviews(pid, arr){
    localStorage.setItem('reviews:'+pid, JSON.stringify(arr));
  }

  function renderReviewsBox(){
    const u = getCurrentUser();
    const box = document.getElementById('pd_review_form');
    if(!u){
      box.innerHTML = '<p class="section__subheader">Please <a href="login.html" class="price__btn" style="padding:.25rem .5rem;">login</a> or <a href="register.html" class="price__btn" style="padding:.25rem .5rem;">register</a> to write a review.</p>';
      return;
    }
    box.innerHTML = `
      <h4 style="color:#fff; margin-bottom:.5rem;">Write a review</h4>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:.75rem;">
        <select id="rvStars" class="pd__select">
          <option value="5">5 - Excellent</option>
          <option value="4">4 - Good</option>
          <option value="3">3 - Average</option>
          <option value="2">2 - Poor</option>
          <option value="1">1 - Bad</option>
        </select>
        <input id="rvTitle" placeholder="Title" style="padding:.75rem .9rem; border-radius:6px; border:1px solid var(--primary-color-extra-light);"/>
      </div>
      <textarea id="rvText" placeholder="Share your experience" style="width:100%; margin-top:.75rem; min-height:120px; padding:.75rem .9rem; border-radius:6px; border:1px solid var(--primary-color-extra-light);"></textarea>
      <button id="rvBtn" class="btn" style="margin-top:.75rem;">Submit Review</button>
    `;
    document.getElementById('rvBtn').addEventListener('click', ()=>{
      const stars = Number(document.getElementById('rvStars').value);
      const title = document.getElementById('rvTitle').value.trim();
      const text = document.getElementById('rvText').value.trim();
      if(!text){ alert('Please write some review text'); return; }
      const list = getProdReviews(product.id);
      list.unshift({ user:u.name||u.email, stars, title, text, ts:Date.now() });
      setProdReviews(product.id, list);
      renderDynamicReviews();
      document.getElementById('rvTitle').value=''; document.getElementById('rvText').value='';
      alert('Review submitted');
    });
  }

  function renderDynamicReviews(){
    const box = document.getElementById('pd_reviews');
    const list = getProdReviews(product.id);
    if(!list.length){ box.innerHTML = '<p class="section__subheader">No reviews yet. Be the first to review.</p>'; return; }
    box.innerHTML = list.map(r=>`
      <div class="review">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <strong style="color:#fff;">${r.user}</strong>
          <div class="rating">${(function(){let s=''; for(let i=0;i<r.stars;i++) s+='<span class=star>★</span>'; for(let i=r.stars;i<5;i++) s+='<span class=star style=opacity:.35;>★</span>'; return s;})()}</div>
        </div>
        <div style="color:#fff; margin-top:.25rem; font-weight:600;">${r.title||''}</div>
        <p style="margin-top:.15rem;">${r.text}</p>
      </div>
    `).join('');
  }

  renderDynamicReviews();
  renderReviewsBox();


    // Related (same group)
    function renderRelated(){
      const wrap = document.getElementById('pd_related');
      const same = catalog.filter(p=>p.group===product.group && p.id!==product.id).slice(0,3);
      same.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'explore__card';
        card.innerHTML = `
          <span>${p.tag[0]}</span>
          <a href="product-details.html?id=${p.id}">
            <img src="${p.img}" alt="${p.name}"/>
            <h4>${p.name}</h4>
          </a>
          <p>Top pick in ${p.tag} category.</p>
          <p style="color:#fff; font-weight:600;">${money(p.price)}</p>
          <div style="display:flex; gap:0.5rem;">
            <a href="cart.html" class="btn" onclick="addToCart({id:'${p.id}',name:'${p.name}',price:${p.price},img:'${p.img}'})">Add to Cart</a>
            <a href="product-details.html?id=${p.id}" class="price__btn">View</a>
          </div>
        `;
        wrap.appendChild(card);
      });
    }
    renderRelated();

    // Minor nav arrows reuse
    document.getElementById('rprev').addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));
    document.getElementById('rnext').addEventListener('click', ()=>window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'}));
  </script>
  <script src="auth.js"></script>


</body>
</html>
